#!groovy
import uk.gov.hmcts.contino.AppPipelineDsl

@Library("Infrastructure")

def type = "java"
def product = "et"
def component = "sya-api"
def branchesToSync = ['perftest', 'demo', 'ithc']

withPipeline(type, product, component) {
  disableLegacyDeployment()
  enablePactAs([AppPipelineDsl.PactRoles.CONSUMER])

  afterAlways('functionalTest:preview') {
          util.archiveArtifacts allowEmptyArchive: true, artifacts: '**/site/serenity/**/*'
      }

  afterAlways('functionalTest:aat') {
          util.archiveArtifacts allowEmptyArchive: true, artifacts: '**/site/serenity/**/*'
      }

      onMaster() {
          enablePactAs([AppPipelineDsl.PactRoles.CONSUMER, AppPipelineDsl.PactRoles.CONSUMER_DEPLOY_CHECK])
      }
      onPR() {
          enablePactAs([AppPipelineDsl.PactRoles.CONSUMER, AppPipelineDsl.PactRoles.CONSUMER_DEPLOY_CHECK])
      }
  }

  syncBranchesWithMaster(branchesToSync)
  enableSlackNotifications('#et-builds')
}
